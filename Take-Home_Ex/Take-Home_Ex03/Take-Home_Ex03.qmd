---
title: "Take-home Exercise 3"
author: "Eda Chang"
---

# The Task

In this exercise, we are required to uncover the salient patterns of the resale prices of public housing property by residential towns and estates in Singapore.

# 1. Introduction

As of 2020, 78.7% of Singaporeans live in public housing. In Singapore, there are three types of housing: lessee-occupied public housing, resale public housing, and rental public housing.

The majority of Singapore's public housing is under lessee-occupied. Housing units are offered on a 99-year leasehold basis to applicants who meet specified income, citizenship, and property leasehold ownership requirements under Singapore's housing leasehold ownership program. The government still owns the estate's land and communal areas. New lessee-occupied flats will be sold via the Build-To-Order and Sale of Balance Flats programs. However, lessee-occupied public housing ca be sold in a resale market, subject to certain regulations. The government does not regulate resale market prices. Therefore,Â this exercise aims to look at the distribution and prices of the public housing in Singapore, which could be relevant in aiding the readers in making informed decisions when evaluation the resale market.

# 2. Data

We will be using "*Resale flat princes based on registration date from Jan-2017 onwards"* which is available at [Data.gov.sg](https://data.gov.sg/). For this exercise, we will only be looking at 2022 data and focusing on 3-Room, 4-Room and 5-Room types.

# 3. Data Preparation

Ensure following packages are installed.

```{r}
packages = c('tidyverse','knitr', 'scales','sf', 'tmap', 'highcharter', 'plotly','lubridate')

for(p in packages){
  if(!require(p, character.only = T)){
    install.packages(p)
  }
  library(p, character.only = T)
}

```

First, we use the read_csv() function of the readr package to import *Resale flat princes based on registration date from Jan-2017 onwards* csv dataset into the R environment.

```{r}
SGResale_2022 <- read_csv("data/resale-flat-prices-based-on-registration-date-from-jan-2017-onwards.csv")
```

read.csv() function from base R has the same functionality as read csv().

Note: read csv() function is preferred over read.csv() because it preserves the whole variable name. read.csv() replaces any spaces in variable names with a period (.), where the names of the variables will be changed.

As we will only be looking at 2022 data and focusing on 3-Room, 4-Room and 5-Room types, we perform the following filters on the dataset.

-   Filter dataset where flat_type is 3-Room, 4-Room & 5-Room

-   Filter dataset based on Year 2022

```{r}

SGResale_2022 <- subset(SGResale_2022, flat_type == "3 ROOM" | flat_type == "4 ROOM" |flat_type == "5 ROOM")
SGResale_2022$Year = substr(SGResale_2022$month, 1, 4)
SGResale_2022 <- subset(SGResale_2022, Year == "2022")
```

# 3. Visualization

## 3.1 Time Analysis

1.  By plotting both resale volume and resale price over time, we can see how the HDB prices varies across Year 2022.

We group the dataset by month and aggregate by average price:

```{r}
SGResale_2022_bymonth <- SGResale_2022 %>%
  group_by(month) %>% 
  mutate(average_price = mean(resale_price))
```

Plotting both axis on the same graph:

```{r}
 ggplot(data = SGResale_2022_bymonth) +
  # Plot the price
  geom_bar(mapping = aes(x=month), fill="khaki2") +
  # Change position of price
  geom_point(mapping = aes(x=month, y=average_price/300), color = "royalblue4") +
  geom_line(mapping = aes(x=month, y=average_price/300), group = 1, color = "royalblue4") +
  # Add a second Y axis
  scale_y_continuous(sec.axis = sec_axis(~.*300, name = "Resale price (SGD)", labels = comma)) +
  
  # Change color of the second Y axis to match with the color of resale price
  theme_minimal() +
  theme(axis.ticks.y.right = element_line(color = "royalblue4"),
        axis.text.y.right = element_text(color = "royalblue4"), 
        axis.title.y.right = element_text(color = "royalblue4")) +
  
  # Adjust styles, lables and add title
  theme(axis.text.x=element_text(angle = 35)) +
  labs(title = "HDB resale market in Year 2022", y="Resale volume", 
       x = "Month", caption = "Source of data: Singapore Housing and Development Board")
```

2.  Plot boxplot by quarter and across flat type to see how prices fluctuated in the last year for different flat types.

```{r}
SGResale_2022_byflat <- SGResale_2022 %>%
  group_by(flat_type) %>% 
  mutate(quarter = quarter(ym(month)),
         price_per_sqm = resale_price/floor_area_sqm)
```

```{r}
ggplot(data = SGResale_2022_byflat, mapping = aes(x = flat_type, y = price_per_sqm)) +
   geom_boxplot(color = "black") +
  theme_minimal() +
  theme(legend.position = "top") +
  scale_fill_viridis_d(option = "A") +
  # Adjust lables and add title
  labs(title = "HDB resale prices in 2022 by flat type", y="Price per square metre (SGD)",
       x = "Flat type", caption = "Source of data: Singapore Housing and Development Board")
```

Using lubridate package, month can be transformed to quarters.

```{r}
ggplot(data = SGResale_2022_byflat, mapping = aes(x = flat_type, y = price_per_sqm)) +
  # Make grouped boxplot
  geom_boxplot(aes(fill = as.factor(quarter)), color = "black") +
  theme_minimal() +
  theme(legend.position = "top") +
  scale_fill_viridis_d(option = "D") +
  # Adjust lables and add title
  labs(title = "HDB resale prices in 2022 by flat type", y="Price per square metre (SGD)", fill = "Quarter",
       x = "Flat type", caption = "Source of data: Singapore Housing and Development Board ")
```

::: panel-tabset
## Plot

```{r}
ggplot(data = SGResale_2022_byflat, mapping = aes(x = flat_type, y = price_per_sqm)) +
  # Make grouped boxplot
  geom_boxplot(aes(fill = as.factor(quarter)), color = "black") +
  theme_minimal() +
  theme(legend.position = "top") +
  scale_fill_viridis_d(option = "D") +
  # Adjust lables and add title
  labs(title = "HDB resale prices in 2022 by flat type", y="Price per square metre (SGD)", fill = "Quarter",
       x = "Flat type", caption = "Source of data: Singapore Housing and Development Board ")

```

## Data

```{r}
ggplot(data = SGResale_2022_byflat, mapping = aes(x = flat_type, y = price_per_sqm)) +
  # Make grouped boxplot
  geom_boxplot(aes(fill = as.factor(quarter)), color = "black") +
  theme_minimal() +
  theme(legend.position = "top") +
  scale_fill_viridis_d(option = "D") +
  # Adjust lables and add title
  labs(title = "HDB resale prices in 2022 by flat type", y="Price per square metre (SGD)", fill = "Quarter",
       x = "Flat type", caption = "Source of data: Singapore Housing and Development Board ")
```
:::

# 4. Key Observations

# 6. References
